import{_ as c,o,c as m,r as h,a,b as x,d as u,F as p,g as y,n as b}from"./admin-aSdWchZB.js";const _={props:{value:Array|String,params:Object,width:{type:String,default:"120px"},height:{type:String,default:"120px"}},emits:["updateValue"],data(){return{images:this.value?this.value:[],set:this._set,assocImages:{}}},computed:{isAddAllowed(){let t=1;if(this.params.field.multiple)if(this.params.field.limit)t=this.params.field.limit;else{if(this.params.field.multiple===!0)return!0;let e=parseInt(this.params.field.multiple);isNaN(e)||(t=e)}return this.images.length<t}},methods:{addSortable(){let t=document.getElementById("sortableList");if(t){let e=this;Sortable.create(t,{handle:".d-drag",animation:150,onEnd:function(i){const d=document.querySelector("#sortableList").querySelectorAll(".uploaded_image");e.images=[],d.forEach(s=>{let r=s.id;e.images.push(e.assocImages[r])}),e.updateData()}})}},updateData(){this.$emit("updateValue",this.images)},updateIndex(){this.assocImages={};for(let t=0;t<this.images.length;t++)this.assocImages[this.images[t].id]=this.images[t]},remove(t){let e=this.images.indexOf(t);this.images.splice(e,1),this.updateData()},edit(t){let e=t.originalTarget,i=e.getAttribute("id");if(this.check(e)){for(let l=0;l<this.images.length&&this.images[l].id!=i;l++);this.images.splice(current_image_i,1),e.files.forEach((l,d)=>{let s=this,r=new FileReader;r.onloadend=function(n){let g=s.getRndId(),f={type:"image",id:g,url:n.target.result,file:l};s.images.splice(current_image_i,0,f),s.assocImages[g]=f},r.readAsDataURL(l)}),this.updateData()}},add(t){let e=t.target;if(this.check(e)){for(let i=0;i<e.files.length;i++){let l=e.files[i];console.log(l);let d=this,s=new FileReader;s.onloadend=function(r){let n=d.getRndId(),g={type:"image",id:n,url:r.target.result,file:l};d.images.push(g),d.assocImages[n]=g},s.readAsDataURL(l)}this.updateData()}},check(t){return t.files==null?!1:Array.from(t.files).every(i=>i.type.includes("image/"))?!0:(this.$emitter.emit("add-flash",{type:"warning",message:"Uploaded file is not an image"}),!1)},getRndId(){return"image_"+Math.random()*1e4}},mounted(){console.log("this value: ",this.value),this.updateIndex(),this.addSortable()}},v={class:"grid mt-4"},k={class:"flex flex-wrap gap-1"},w=["for"],I={class:"flex flex-col items-center"},A=["id"],j={key:1,id:"sortableList",class:"flex flex-wrap gap-1"},S=["src","onError"],E={class:"absolute top-0 bottom-0 flex flex-col justify-between invisible w-full p-3 transition-all bg-white opacity-80 group-hover:visible dark:bg-gray-900"},D={class:"flex justify-between"},R=["onClick"],F=["for"],L={key:0,type:"hidden"},C=["name","id"];function N(t,e,i,l,d,s){return o(),m(p,null,[h(t.$slots,"label"),a("div",v,[a("div",k,[s.isAddAllowed?(o(),m("label",{key:0,class:"grid h-[120px] max-h-[120px] min-h-[110px] w-full min-w-[110px] max-w-[120px] cursor-pointer items-center justify-items-center rounded border border-dashed border-gray-300 transition-all hover:border-gray-400 dark:border-gray-800 dark:mix-blend-exclusion dark:invert",style:{"max-width":"120px","max-height":"120px"},for:"new_imageInput_"+i.params.field.key},[a("div",I,[e[2]||(e[2]=a("span",{class:"text-2xl icon-image"},null,-1)),e[3]||(e[3]=a("p",{class:"grid text-sm font-semibold text-center text-gray-600 dark:text-gray-300"},[x(" Add Image "),a("span",{class:"text-xs"}," png, jpeg, jpg ")],-1)),a("input",{type:"file",class:"hidden",id:"new_imageInput_"+i.params.field.key,accept:"image/*",multiple:"",onChange:e[0]||(e[0]=(...r)=>s.add&&s.add(...r))},null,40,A)])],8,w)):u("",!0),d.images?(o(),m("div",j,[(o(!0),m(p,null,y(d.images,r=>(o(),m("div",{key:"image"+i.params.field.key,class:"d-drag cursor-grabbing group relative grid max-h-[120px] min-w-[120px] justify-items-center overflow-hidden rounded transition-all hover:border-gray-400"},[a("img",{src:r.url,style:b({width:this.width,height:this.height}),onError:n=>t.logError(r.url)},null,44,S),a("div",E,[e[6]||(e[6]=a("p",{class:"text-xs font-semibold text-gray-600 break-all dark:text-gray-300"},null,-1)),a("div",D,[a("span",{class:"cursor-pointer rounded-md p-1.5 text-2xl hover:bg-gray-200 dark:hover:bg-gray-800",onClick:n=>s.remove(r)},e[4]||(e[4]=[a("i",{class:"fa-solid fa-trash"},null,-1)]),8,R),a("label",{class:"cursor-pointer rounded-md p-1.5 text-2xl hover:bg-gray-200 dark:hover:bg-gray-800",for:i.params.field.key},e[5]||(e[5]=[a("i",{class:"fa-solid fa-pen-to-square"},null,-1)]),8,F),r.is_new?u("",!0):(o(),m("input",L)),a("input",{type:"file",name:i.params.field.key,class:"hidden uploaded_image",accept:"image/*",multiple:"",id:i.params.field.key,ref_for:!0,ref:"imageInput_"+i.params.field.key,onChange:e[1]||(e[1]=(...n)=>s.edit&&s.edit(...n))},null,40,C)])])]))),128))])):u("",!0)])]),h(t.$slots,"error")],64)}const B=c(_,[["render",N]]);export{B as default};
