import{_ as c,e as m,o as p,c as f,r as u,f as h,F as g,E as _}from"./admin-DeITPjpc.js";const k={props:["value","params"],inject:["csrf_token"],data(){return{_value:this.value,currentSkin:"",currentContentCSS:"",document_base_url:"{{ asset("/") }}",uploadRoute:window.location.origin+"/admin/tinymce/upload",csrfToken:this.csrf_token}},components:{Editor:_},updated(){this.$emit("update-value",this._value)},methods:{setSkins(){this.currentSkin=this.calcCurrentSkin(),this.currentContentCSS=this.calcCurrentContentCSS()},calcCurrentSkin(){return document.querySelector("html").classList.contains("dark")?"oxide-dark":"oxide"},calcCurrentContentCSS(){return document.querySelector("html").classList.contains("dark")?"dark":"default"},getConfig(){var i=this,o={plugins:"image media wordcount save fullscreen code table lists link",menubar:"file edit view insert format tools table help",toolbar:"formatselect | bold italic strikethrough forecolor backcolor image media alignleft aligncenter alignright alignjustify link hr numlist bullist outdent indent removeformat code table | fullscreen",skin:this.currentSkin,content_css:this.currentContentCSS,promotion:!1,image_advtab:!0,document_base_url:this.document_base_url,uploadRoute:this.uploadRoute,csrfToken:this.csrf_token,automatic_uploads:!0,images_reuse_filename:!0,images_upload_handler:(n,r)=>new Promise((e,t)=>{i.uploadImageHandler(n,e,t,r)}),file_picker_callback:function(n,r,e){i.filePickerCallback(n,r,e)}};return o},uploadImageHandler(i,o,n,r){let e,t;e=new XMLHttpRequest,e.withCredentials=!1,e.open("POST",this.uploadRoute),e.upload.onprogress=a=>r(a.loaded/a.total*100),e.onload=function(){let a;if(e.status===403){n("@lang('admin::app.error.tinymce.http-error')",{remove:!0});return}if(e.status<200||e.status>=300){n("@lang('admin::app.error.tinymce.http-error')");return}if(a=JSON.parse(e.responseText),!a||typeof a.location!="string"){n("@lang('admin::app.error.tinymce.invalid-json')"+e.responseText);return}o(a.location)},e.onerror=()=>n("@lang('admin::app.error.tinymce.upload-failed')"),t=new FormData,t.append("_token",this.csrfToken),t.append("file",i.blob(),i.filename()),e.send(t)},filePickerCallback:function(i,o,n){let r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("accept","image/*"),r.onchange=function(){let e=this.files[0],t=new FileReader;t.readAsDataURL(e),t.onload=function(){let a="blobid"+new Date().getTime(),l=tinymce.activeEditor.editorUpload.blobCache,d=t.result.split(",")[1],s=l.create(a,e,d);l.add(s),i(s.blobUri(),{title:e.name})}},r.click()},reinitializeEditor(){this.setSkins(),this.$refs["editor_"+this.params.dotted_name].rerender(this.getConfig())}},created(){this.setSkins(),window.addEventListener("change-theme",()=>{this.reinitializeEditor()})},unmounted(){window.removeEventListener("change-theme",()=>{})}};function b(i,o,n,r,e,t){const a=m("Editor");return p(),f(g,null,[u(i.$slots,"label"),h(a,{ref:"editor_"+n.params.dotted_name,modelValue:e._value,"onUpdate:modelValue":o[0]||(o[0]=l=>e._value=l),init:t.getConfig()},null,8,["modelValue","init"]),u(i.$slots,"error")],64)}const S=c(k,[["render",b]]);export{S as default};
